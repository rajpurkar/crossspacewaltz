<!DOCTYPE HTML>
<html>
    <head>
        <style>
			     body {
				    margin: 0px;
				    padding: 0px;
			     }
      .mirror{
        -moz-transform: scale(-1, 1);
        -webkit-transform: scale(-1, 1);
        -o-transform: scale(-1, 1);
        -ms-transform: scale(-1, 1);
        transform: scale(-1, 1);
      }
			#myCanvas {
				width: 100%;
				height: 100%;
				border: 1px solid #000;
			}
			#statsPanel {
				position: absolute;
				width: 100%;
				height: 8%;
				bottom: 0;
				opacity: 0.8;
				border: 2px solid;
			}
			#gameArea {
				position: absolute;
				left: 50%;
				top: 50%;
			}
        </style>
    </head>
    <body>
        <div id="headtrackrContainer">
          <canvas id="headtrackrCanvas" style="z-index:100;position:absolute" width="320" height="240"></canvas>
          <video id="headtrackrVideo" autoplay loop class="mirror"></video>
        </div>

        <div id="container"></div>

        <script src="javascripts/headtrackr.js"></script>
        <script src="javascripts/headcontrol.js"></script>

        <div id='gameArea'>
            <canvas id='myCanvas'></canvas>
            <div id='statsPanel'></div>
        </div>
        <script src="/socket.io/socket.io.js"></script>
        <script src="javascripts/jquery.js"></script>

        <script>
            resizeGame();
function resizeGame() {
                var gameArea = document.getElementById('gameArea');
                var widthToHeight = 4 / 3;
                var newWidth = window.innerWidth;
                var newHeight = window.innerHeight;
                var newWidthToHeight = newWidth / newHeight;

                if (newWidthToHeight > widthToHeight) {
                    newWidth = newHeight * widthToHeight;
                    gameArea.style.height = newHeight + 'px';
                    gameArea.style.width = newWidth + 'px';
                } else {
                    newHeight = newWidth / widthToHeight;
                    gameArea.style.width = newWidth + 'px';
                    gameArea.style.height = newHeight + 'px';
                }

                gameArea.style.marginTop = (-newHeight / 2) + 'px';
                gameArea.style.marginLeft = (-newWidth / 2) + 'px';

                var gameCanvas = document.getElementById('myCanvas');
                gameCanvas.width = newWidth;
                gameCanvas.height = newHeight;
            }


            window.addEventListener('resize', resizeGame, false);
            window.addEventListener('load', resizeGame, false);
            window.addEventListener('orientationchange', resizeGame, false);
            </script>








            <script>
            var socket = io.connect('http://10.34.190.89:3000/');

			var canvas = document.getElementById('myCanvas');
			var context = canvas.getContext('2d');
			var mousePos = {
				x : 0,
				y : 0
			};
			var otherMouse = {};

			function writeMessage() {
				context.font = '18pt Calibri';
				context.fillStyle = 'black';
				context.fillText('Mouse position: ' + mousePos.x + ',' + mousePos.y, 10, 25);
			}

			function getMousePos(canvas, evt) {
				var rect = canvas.getBoundingClientRect();
				return {
					x : evt.clientX - rect.left,
					y : evt.clientY - rect.top
				};
			}

			function drawCircle(center, color) {
				var radius = 70;
				context.beginPath();
				context.arc(center.x, center.y, radius, 0, 2 * Math.PI, false);
				context.fillStyle = color;
				context.fill();
				context.lineWidth = 5;
				context.strokeStyle = '#003300';
				context.stroke();
			}

			function drawMousePosition(){
                drawCircle(mousePos, 'green');
			}

			function drawOtherMousePositions(){
                for (var key in otherMouse) {
                    drawCircle(otherMouse[key], 'blue');
                }
			}

			canvas.addEventListener('mousemove', function(evt) {
				mousePos = getMousePos(canvas, evt);
                socket.emit('msg', mousePos);
			}, false);

			window.requestAnimFrame = (function(callback) {
				return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
				function(callback) {
					window.setTimeout(callback, 1000 / 60);
				};
			})();

			function drawLine() {
				context.beginPath();
				context.moveTo(100, 150);
				context.lineTo(450, 50);
				context.stroke();
			}

			function animate() {
				// update
				// clear
				context.clearRect(0, 0, canvas.width, canvas.height);

				// draw stuff
				writeMessage();
				drawLine();
				drawMousePosition();
				drawOtherMousePositions();
				// request new frame
				requestAnimFrame(function() {
					animate();
				});
			}

			animate();

socket.on('left', function(data){
    delete otherMouse[data.id];
})

            socket.on('lol', function(data) {
                otherMouse[data.id] = {x:data.pos.x, y:data.pos.y};
                //console.log(data.id, data.pos.x, data.pos.y);
            });
            /*
            console.log('hi');
			socket.on('news', function(data) {
			    console.log("news");
				socket.emit('msg', {
					data : 'hi'
				});
			});
			*/
        </script>
    </body>
</html>
